@{
    Layout = "~/Views/Shared/_LayoutMain.cshtml";
    ViewBag.Title = "Administración General";
}

<section class="vacantes-wrapper">
    <h2 class="vacantes-titulo titulo-principal">Administración General</h2>


    <div class="container mt-4">
        <div class="row gy-3 mb-4">
            <div class="col-md-4">
                <button class="btn btn-outline-primary w-100 py-3 shadow rounded-4"
                        onclick="mostrarSeccion('usuarios')">
                    <i class="fas fa-users me-2"></i> Gestión de Usuarios
                </button>
            </div>
            <div class="col-md-4">
                <button class="btn btn-outline-success w-100 py-3 shadow rounded-4"
                        onclick="mostrarSeccion('especialidades')">
                    <i class="fas fa-tools me-2"></i> Gestión de Especialidades
                </button>
            </div>
            <div class="col-md-4">
                <button class="btn btn-outline-warning w-100 py-3 shadow rounded-4"
                        onclick="mostrarSeccion('secciones')">
                    <i class="fas fa-layer-group me-2"></i> Gestión de Secciones
                </button>
            </div>
        </div>
    </div>



    <!-- Gestión de Usuarios -->
    <!--<div id="usuarios" class="seccion-adm" style="display: none;">
        <h3>Gestión de Usuarios</h3>
        <div class="table-container">
            <table class="display responsive nowrap w-100">
                <thead>
                    <tr>
                        <th>Nombre</th>
                        <th>Cédula</th>
                        <th>Email</th>
                        <th>Rol</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Laura Rodríguez</td>
                        <td>12345678</td>
                        <td>laura@email.com</td>
                        <td>Estudiante</td>
                        <td>Activo</td>
                        <td>
                            <a href="@Url.Action("EditarRolUsuario", "AdministracionGeneral", new { id = 1 })" class="btn bg-transparent" title="Editar Rol"><i class="fas fa-user-cog"></i></a>
                            <a href="@Url.Action("CambiarEstadoUsuario", "AdministracionGeneral", new { id = 1 })" class="btn bg-transparent" title="Inactivar"><i class="fas fa-user-slash"></i></a>
                        </td>
                    </tr>-->
    <!-- Más usuarios -->
    <!--</tbody>
            </table>
        </div>
    </div>-->
    <!-- Gestión de Usuarios -->
    <div id="usuarios" class="seccion-adm" style="display: none;">
        <h3>Gestión de Usuarios</h3>

        <!-- Filtro por Rol -->
        <div class="row mb-3">
            <div class="col-md-4">
                <label for="filtroRol" class="form-label">Filtrar por rol:</label>
                <select id="filtroRol" class="form-control">
                    <option value="">Todos</option>
                    <option value="Estudiante">Estudiante</option>
                    <option value="Profesor">Profesor</option>
                    <option value="Egresado">Egresado</option>
                    <option value="Coordinador">Coordinador</option>
                </select>
            </div>
        </div>

        <!-- Tabla de Usuarios -->
        <div class="table-container">
            <table id="tablaUsuarios" class="display responsive nowrap w-100">
                <thead>
                    <tr>
                        <th>Nombre</th>
                        <th>Cédula</th>
                        <th>Email</th>
                        <th>Rol</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <tr data-rol="Estudiante">
                        <td>Laura Rodríguez</td>
                        <td>12345678</td>
                        <td>laura@email.com</td>
                        <td>Estudiante</td>
                        <td>Activo</td>
                        <td>
                            <a href="@Url.Action("EditarRolUsuario", "AdministracionGeneral", new { id = 1 })"
                               class="btn btn-sm btn-outline-secondary me-1" title="Editar Rol">
                                <i class="fas fa-user-cog"></i>
                            </a>

                            <a href="@Url.Action("CambiarEstadoUsuario", "AdministracionGeneral", new { id = 1 })"
                               class="btn btn-sm btn-outline-danger" title="Inactivar">
                                <i class="fas fa-user-slash"></i>
                            </a>
                        </td>
                    </tr>
                    <!-- Más usuarios dinámicos -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Gestión de Especialidades -->
    <div id="especialidades" class="seccion-adm" style="display: none;">
        <h3>Gestión de Especialidades</h3>
        <a href="@Url.Action("CrearEspecialidad", "AdministracionGeneral")" class="btn btn-success mb-2">+ Nueva Especialidad</a>
        <div class="table-container">
            <table class="display responsive nowrap w-100">
                <thead>
                    <tr>
                        <th>Nombre</th>
                        <th>Descripción</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Informática</td>
                        <td>Desarrollo de software y redes</td>
                        <td>
                            <a href="@Url.Action("EditarEspecialidad", "AdministracionGeneral", new { id = 1 })" class="btn bg-transparent" title="Editar"><i class="fas fa-edit"></i></a>
                            <a href="@Url.Action("EliminarEspecialidad", "AdministracionGeneral", new { id = 1 })" class="btn bg-transparent" title="Eliminar"><i class="fas fa-trash-alt"></i></a>
                        </td>
                    </tr>
                    <!-- Más especialidades -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Gestión de Secciones -->
    <div id="secciones" class="seccion-adm" style="display: none;">
        <h3>Gestión de Secciones</h3>
        <a href="@Url.Action("CrearSeccion", "AdministracionGeneral")" class="btn btn-success mb-2">+ Nueva Sección</a>
        <div class="table-container">
            <table class="display responsive nowrap w-100">
                <thead>
                    <tr>
                        <th>Código</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>SEC-01</td>
                        <td>
                            <a href="@Url.Action("EditarSeccion", "AdministracionGeneral", new { id = 1 })" class="btn bg-transparent" title="Editar"><i class="fas fa-edit"></i></a>
                            <a href="@Url.Action("EliminarSeccion", "AdministracionGeneral", new { id = 1 })" class="btn bg-transparent" title="Eliminar"><i class="fas fa-trash-alt"></i></a>
                        </td>
                    </tr>
                    <!-- Más secciones -->
                </tbody>
            </table>
        </div>
    </div>
</section>

@section Scripts {
    <!-- Font Awesome actualizado -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha512-..." crossorigin="anonymous" referrerpolicy="no-referrer" />

    <script>
        function mostrarSeccion(id) {
            document.querySelectorAll('.seccion-adm').forEach(s => s.style.display = 'none');
            document.getElementById(id).style.display = 'block';

            if (id === 'usuarios') {
                // Destruir tabla si ya está inicializada
                if ($.fn.DataTable.isDataTable('#tablaUsuarios')) {
                    $('#tablaUsuarios').DataTable().destroy();
                }

                // Re-inicializar
                $('#tablaUsuarios').DataTable({
                    responsive: true
                });
            }
        }

        $(document).ready(function () {
            // Inicializa todas las demás tablas (excepto usuarios, que se inicializa con mostrarSeccion)
            $('table.display').not('#tablaUsuarios').each(function () {
                $(this).DataTable({
                    responsive: true
                });
            });

            // Filtro por rol usando DataTable API
            $('#filtroRol').on('change', function () {
                const valor = this.value;
                const tabla = $('#tablaUsuarios').DataTable();
                tabla.column(3).search(valor).draw(); // Columna 3 = Rol
            });
        });

        $(document).ready(function () {
            // Lo que ya tienes...
            // ...

            // Mostrar pestaña según query string "tab"
            const params = new URLSearchParams(window.location.search);
            const tab = params.get('tab');

            if (tab) {
                mostrarSeccion(tab);
            } else {
                // Si no hay parámetro, puedes mostrar una pestaña por defecto, ej:
                mostrarSeccion('usuarios');
            }
        });
    </script>




}

