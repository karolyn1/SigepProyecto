@{
    Layout = "~/Views/Shared/_LayoutMain.cshtml";
    ViewBag.Title = "Listado de Empresas";
}

<section class="vacantes-wrapper">
    <h2 class="vacantes-titulo titulo-principal">Empresas Registradas</h2>

    <a href="@Url.Action("CrearEmpresa", "Empresa")"
       class="btn-cta btn-nuevo"
       style="margin-bottom: 25px;">+ Nueva Empresa</a>

    <div class="table-container">
        <table id="miTabla" class="display responsive nowrap w-100">
            <thead>
                <tr>
                    <th>Nombre de Empresa</th>
                    <th>Especialidades que Reciben</th>
                    <th>Ubicación</th>
                    <th>Historial de Vacantes</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                <tr data-id="1" data-nombre="TechSolutions">
                    <td>TechSolutions</td>
                    <td>Informática, Electrónica</td>
                    <td>San José</td>
                    <td>5 vacantes anteriores</td>
                    <td>
                        <a href="@Url.Action("EditarEmpresa", "Empresa", new { id = 1 })"
                           class="btn bg-transparent" title="Editar">
                            <i class="fas fa-edit icono-accion"></i>
                        </a>
                        <a href="#"
                           class="btn bg-transparent btn-eliminar-empresa"
                           data-id="1"
                           data-nombre="TechSolutions"
                           title="Eliminar">
                            <i class="fas fa-trash-alt icono-accion"></i>
                        </a>
                    </td>
                </tr>
                <tr data-id="2" data-nombre="InnovaCorp">
                    <td>InnovaCorp</td>
                    <td>Electromecánica</td>
                    <td>Heredia</td>
                    <td>3 vacantes anteriores</td>
                    <td>
                        <a href="@Url.Action("EditarEmpresa", "Empresa", new { id = 2 })"
                           class="btn bg-transparent" title="Editar">
                            <i class="fas fa-edit icono-accion"></i>
                        </a>
                        <a href="#"
                           class="btn bg-transparent btn-eliminar-empresa"
                           data-id="2"
                           data-nombre="InnovaCorp"
                           title="Eliminar">
                            <i class="fas fa-trash-alt icono-accion"></i>
                        </a>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</section>

<!-- Modal Confirmar Eliminación Empresa -->
<div class="modal fade" id="modalEliminarEmpresa" tabindex="-1" aria-labelledby="modalEliminarEmpresaLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Confirmar Eliminación</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body">
                ¿Está seguro que desea eliminar la empresa <strong id="nombreEmpresaEliminar"></strong>?
            </div>
            <div class="modal-footer">
                <form id="formEliminarEmpresa">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-danger">Eliminar</button>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            $('#miTabla').DataTable({
                responsive: true
            });

            let filaAEliminar = null;

            $('.btn-eliminar-empresa').on('click', function (e) {
                e.preventDefault();
                filaAEliminar = $(this).closest('tr');
                const nombreEmpresa = $(this).data('nombre');
                $('#nombreEmpresaEliminar').text(nombreEmpresa);
                $('#modalEliminarEmpresa').modal('show');
            });

            $('#formEliminarEmpresa').on('submit', function (e) {
                e.preventDefault();
                if (filaAEliminar) {
                    filaAEliminar.remove(); // Simulación
                    $('#modalEliminarEmpresa').modal('hide');
                    alert('Empresa eliminada correctamente.');
                }
            });
        });
    </script>
}
