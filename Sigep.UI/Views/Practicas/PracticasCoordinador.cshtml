@{
    Layout = "~/Views/Shared/_LayoutMain.cshtml";
    ViewBag.Title = "Listado de Estudiantes";
}
<h2 class="vacantes-titulo titulo-principal d-flex justify-content-between align-items-center">
    Proceso de Prácticas @DateTime.Now.Year
    <div class="dropdown">
        <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="filtroDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="fas fa-filter"></i>
        </button>
        <div class="dropdown-menu p-3" style="min-width: 300px;">
            <div class="mb-2">
                <label class="Filtros">Estado académico</label>
                <select id="filtroEstadoAcademico" class="form-control">
                    <option value="">Todos</option>
                    <option value="Aprobado">Aprobado</option>
                    <option value="Rezagado">Rezagado</option>
                </select>
            </div>
            <div class="mb-2">
                <label>Estado de práctica</label>
                <select id="filtroPractica" class="form-control">
                    <option value="">Todos</option>
                    <option value="Asignada">Con práctica asignada</option>
                    <option value="No asignada">Sin práctica</option>
                </select>
            </div>
            <div>
                <label>Especialidad</label>
                <input type="text" id="filtroEspecialidad" class="form-control" placeholder="Filtrar por especialidad" />
            </div>
        </div>
    </div>
</h2>

<div class="card rounded-5 p-3">
    <table id="miTabla" class="display responsive nowrap w-100">
        <thead>
            <tr>
                <th>Cédula</th>
                <th>Nombre</th>
                <th>Especialidad</th>
                <th>Teléfono</th>
                <th>Estado de Postulación</th>
                <th>Empresa</th>
                <th>Tipo</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>2023101234</td>
                <td>Laura Rodríguez</td>
                <td>Informática</td>
                <td>8888-8888</td>
                <td><span class="badge badge-asignada">Asignada</span></td>

                <td>Boston Scientific</td>
                <td><span class="badge badge-asignada">Autogestionada</span></td>
                <td>
                   <a href="@Url.Action("VisualizacionPostulacion", "Practicas")" class="btn text-decoration-none bg-transparent" style="color: #2d594d"><i class="fas fa-eye"></i></a>
                   <button class="btn-desasignar-practica bg-transparent text-decoration-none" data-nombre="Laura Rodriguez" style="color: #2d594d; border: 0px;">	<i class="fas fa-trash"></i></button>
                </td>
            </tr>
            
            <tr>
                <td>2022105678</td>
                <td>Juan Pérez</td>
                <td>Electrónica</td>
                <td>8999-9999</td>
                <td><span class="badge badge-no-asignada badge-estado-academico">En Progreso</span></td>
                <td>Boston Scientific</td>
                <td><span class="badge badge-asignada">Asignada por profesor/coordinador</span></td>
                <td>
                    <a href="@Url.Action("VisualizacionPostulacion", "Practicas")" class="btn text-decoration-none bg-transparent" style="color: #2d594d"><i class="fas fa-eye"></i></a>
                    <button class="btn-desasignar-practica bg-transparent text-decoration-none" data-nombre="Juan Pérez" style="color: #2d594d; border: 0px;">	<i class="fas fa-trash"></i></button>
                </td>
            </tr>
        </tbody>
    </table>
</div>




@section scripts {


    <script>
        $(document).ready(function () {
            var table = $('#miTabla').DataTable({
                responsive: true
            });

            // Filtro por estado académico
            $('#filtroEstadoAcademico').on('change', function () {
                table.column(5).search(this.value).draw();
            });

            // Filtro por estado de práctica
            $('#filtroPractica').on('change', function () {
                table.column(4).search(this.value).draw();
            });

            // Filtro por especialidad
            $('#filtroEspecialidad').on('keyup', function () {
                table.column(2).search(this.value).draw();
            });

            $(".CambiarEstado").on("click", function () {
                var fila = $(this).closest("tr");
                var estadoAcademicoSpan = fila.find("td:nth-child(6) .badge-estado-academico");

                Swal.fire({
                    title: 'Selecciona el nuevo estado académico',
                    input: 'select',
                    inputOptions: {
                        'Aprobado': 'Aprobado',
                        'Rezagado': 'Rezagado'
                    },
                    inputPlaceholder: 'Selecciona un estado',
                    showCancelButton: true,
                    confirmButtonText: 'Actualizar',
                    customClass: {
                        confirmButton: 'btn-verde-personalizado'
                    },
                    cancelButtonText: 'Cancelar',
                    customClass: {
                        confirmButton: 'btn-verde-personalizado'
                    },
                    inputValidator: (value) => {
                        if (!value) {
                            return 'Debes seleccionar un estado';
                        }
                    }
                }).then((result) => {
                    if (result.isConfirmed) {

                        var nuevoEstado = result.value;
                        estadoAcademicoSpan.text(nuevoEstado);

                        if (nuevoEstado === 'Aprobado') {
                            estadoAcademicoSpan.removeClass().addClass('badge badge-estado-academico badge-asignada');
                        } else if (nuevoEstado === 'Rezagado') {
                            estadoAcademicoSpan.removeClass().addClass('badge badge-estado-academico badge-no-asignada');
                        }

                        Swal.fire('Actualizado!', 'El estado académico ha sido actualizado.', 'success');
                    }
                });
            });

        });
    </script>
}
